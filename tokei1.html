<!DOCTYPE html>
<html lang="ja">
<HEAD>
<TITLE>時計１</TITLE> 
<META http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="robots" content="noindex">

<script type="text/javascript">
//【JavaScript】canvasでアナログ時計
//https://www.softel.co.jp/blogs/tech/archives/3914


const t1 = new clock('tokei1');
const t2 = new clock('tokei2');

function init(){
    document.addEventListener('touchstart', function(event){
        const a = document.getElementById("allow");
        a.focus();
    }, false);

    const h1 = document.getElementById("h1");
    const m1 = document.getElementById("m1");
    const h2 = document.getElementById("h2");
    const m2 = document.getElementById("m2");

    
    t1.show(h1.value, m1.value);
    t2.show(h2.value, m2.value);
}
function change(){
    const h1 = document.getElementById("h1");
    const m1 = document.getElementById("m1");
    const h2 = document.getElementById("h2");
    const m2 = document.getElementById("m2");

    t1.show(h1.value, m1.value);
    t2.show(h2.value, m2.value);

    h1.value = 0;
    m1.value = 0;
    h2.value = 0;
    m2.value = 0;
}
function random1(){
    const hour = Math.round( Math.random()*9 );
    const interval = Math.round( Math.random() ) +1;
    const min1 = [0,30][Math.round( Math.random() )];
    const min2 = [0,30][Math.round( Math.random() )];

    t1.show(hour, min1);
    t2.show(hour+interval, min2);
    //console.log("hour:"+hour+", interval:"+interval+", min:"+min);
}
function random2(){
    const hour = Math.round( Math.random()*9 );
    const interval = Math.round( Math.random() ) +1;
    const min1 = Math.round( Math.random()*6 ) *10;
    const min2 = Math.round( Math.random()*6 ) *10;

    t1.show(hour, min1);
    t2.show(hour+interval, min2);
    //console.log("hour:"+hour+", interval:"+interval+", min:"+min);
}

function clock(id){
    this.id = id;
    this.init = function(){
        this.timerId = null;
        this.canvas = document.getElementById(this.id);
        this.ctx = this.canvas.getContext('2d');
        this.width = this.canvas.width;
        this.height = this.canvas.height;

        // 文字盤の数字の中心までの半径(canvas の半分より少し小さく)
        this.rads = 93; 
        
        var x = this.ctx;
        x.translate(this.width / 2, this.height / 2); 
        x.scale(this.width / 200, this.height / 200); 
        x.rotate(-Math.PI/2); 
        x.strokeStyle = "black"; 
        x.fillStyle = "white"; 
        x.lineCap = "butt";  
    }

    this.memoriM = function(){
        var x = this.ctx;
        x.save();
        x.lineWidth = 2; 
        for (var i = 0; i < 60; i++) { 
            x.beginPath(); 
            x.rotate(Math.PI/30); 
            x.moveTo(75,0); 
            x.lineTo(85,0); 
            x.stroke(); 
        } 
        x.restore();
    }
    this.memoriH = function(){
        var x = this.ctx;
        x.save();
        x.lineWidth = 5; 
        for (var i = 0; i < 12; i++) { 
            x.beginPath(); 
            x.rotate(Math.PI/6); 
            x.moveTo(65,0); 
            x.lineTo(85,0); 
            x.stroke(); 
        } 
        x.restore();
    }
    this.mojiban = function(){
        // 文字盤
        var x = this.ctx;
        x.save();
        x.rotate(Math.PI/2); 
        x.font        = "16px 'Arial'";
        x.textAlign   ="center";
        x.textBaseline    ="middle";
        x.fillStyle   = "rgb(0, 0, 0)";
        x.shadowBlur = 5;
        x.shadowColor = "#FFF";
        for (let i = 0; i < 12; i++) {
            const radian = (i-3) * Math.PI / 6;
            const xx = this.rads * Math.cos(radian);
            const yy = this.rads * Math.sin(radian);
            const text = "" + (i == 0 ? "12" : i);
            console.log(" mojiban: "+text+", x:"+xx+", y:"+yy);
            x.fillText(text, xx, yy);
          }
        x.restore();
    }

    this.h = function(){
        var x = this.ctx;
        x.save();
        x.rotate(Math.PI/6 * (this.datetime.getHours() + this.datetime.getMinutes() / 60)); 
        x.lineWidth = 8; 
        x.beginPath(); 
        x.moveTo(-5, 0); 
        x.lineTo(45, 0); 
        x.stroke(); 
        x.restore();
    }
    this.m = function(){
        var x = this.ctx;
        x.save();
        x.rotate(Math.PI/30 * (this.datetime.getMinutes() + this.datetime.getSeconds() / 60)); 
        x.lineWidth = 4; 
        x.beginPath(); 
        x.moveTo(-5, 0); 
        x.lineTo(70, 0); 
        x.stroke(); 
        x.restore();
    }
    this.s = function(){
        var x = this.ctx;
        x.save();
        x.rotate(Math.PI/30 * this.datetime.getSeconds()); 
        x.strokeStyle = "#cc0000"; 
        x.lineWidth = 2; 
        x.beginPath(); 
        x.moveTo(-10, 0); 
        x.lineTo(70, 0); 
        x.stroke(); 
        x.restore();
    }
    this.ticktack = function(date){
        if (!this.canvas) {
            this.init();
        }
        if(date==null){
            this.datetime = new Date();
        }else{
            this.datetime = date;
        }
        var x = this.ctx;
        x.clearRect(-100, -100, 200, 200);
        this.mojiban();
        this.memoriM();
        this.memoriH();

        this.h();
        this.m();
        this.s();
    }
    this.show = function(h,m){
        date = new Date(2020,6,16,h,m,0);
        var _clock = this;
        _clock.ticktack(date);
    }
    this.start = function(){
        if (!this.timerId) {
            var _clock = this;
            _clock.ticktack();
            this.timerId = setInterval(function(){_clock.ticktack();}, 1000);
        }
    }
    this.stop = function() {
        if (this.timerId) {
            clearInterval(this.timerId);
            this.timerId = null;
        }
    }
}
</script>
<style>
.allow{
    position:relative;
    top:-170px;
    font-size:min(10vh,10vw);
}
.btn{
    font-size: min(3vh, 3vw);
}
.space{
    font-size: min(5vh,5vw);
}
</style>

</head>

<body onload="init()">
左時計より、右時計は何時間何分...？<br>
<canvas id="tokei1" width="400" height="400"></canvas>
<span id="allow" class="allow">➡︎</span>
<canvas id="tokei2" width="400" height="400"></canvas>
<br>
<input type=number id=h1 width=10 value=7>：<input type=number id=m1 width=10 value=30>
<span class="space">　　　　　</span>
<input type=number id=h2 width=10 value=8>：<input type=number id=m2 width=10 value=30>
<input type=button width=20 height=5 value="変更" onclick="change()">
<br/>
<br/>
<hr>
<input type=button width=20 height=5 class="btn" value="ランダムに変える（レベル１）" onclick="random1()">
左時計より、右時計は未来になる（はず）。０分か３０分のみ。
<br/>
<br/>
<input type=button width=20 height=5 class="btn" value="ランダムに変える（レベル２）" onclick="random2()">
左時計より、右時計は未来になる（はず）。０分、１０分、２０分、３０分、４０分、５０分

</body>

</html>
